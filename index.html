<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="description" content="MediBot Assistant provides AI-powered medical guidance, emergency response, medicine analysis, natural remedies, health tips, and balanced diet plans.">
    <meta name="keywords" content="medical assistant, AI health, emergency response, medicine analysis, natural remedies, health tips, balanced diet">
    <meta name="author" content="MediBot Team">
    <title>MediBot</title>
    <link rel="icon" type="image/png" href="/favicon.png">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        :root {
            --bg-gradient: linear-gradient(to right, #ff7e5f, #feb47b, #86a8e7, #7f7fd5);
            --primary-color: #2563eb;
            --secondary-color: #64748b;
            --card-bg: #ffffff;
            --card-shadow: 0 4px 24px rgba(0, 0, 0, 0.08);
            --border-color: #e5e7eb;
            --button-bg: #2563eb;
            --button-hover: #1d4ed8;
            --input-border: #d1d5db;
            --footer-bg: #ffffff;
            --error-color: #dc2626;
            --success-color: #16a34a;
            --warning-color: #f59e0b;
            --sidebar-width: 280px;
            --border-radius: 12px;
        }

        [data-theme="dark"] {
            --bg-gradient: linear-gradient(to right, #1a2a44, #2d4066, #4a6694, #6b8ab3);
            --primary-color: #60a5fa;
            --secondary-color: #9ca3af;
            --card-bg: #2d3748;
            --card-shadow: 0 4px 24px rgba(0, 0, 0, 0.3);
            --border-color: #4b5563;
            --button-bg: #60a5fa;
            --button-hover: #3b82f6;
            --input-border: #4b5563;
            --footer-bg: #1f2937;
            --error-color: #f87171;
            --success-color: #34d399;
            --warning-color: #fbbf24;
        }

        [data-theme="high-contrast"] {
            --bg-gradient: linear-gradient(to right, #000000, #333333, #666666, #999999);
            --primary-color: #60a5fa;
            --secondary-color: #9ca3af;
            --card-bg: #2d3748;
            --card-shadow: 0 4px 24px rgba(0, 0, 0, 0.3);
            --border-color: #4b5563;
            --button-bg: #60a5fa;
            --button-hover: #3b82f6;
            --input-border: #4b5563;
            --footer-bg: #1f2937;
            --error-color: #f87171;
            --success-color: #34d399;
            --warning-color: #fbbf24;
        }

        [data-theme="ocean"] {
            --bg-gradient: linear-gradient(to right, #2b5876, #4ecca3, #6dd5ed, #2193b0);
            --primary-color: #1cb5e0;
            --secondary-color: #a3bffa;
            --card-bg: #e6f0fa;
            --card-shadow: 0 4px 24px rgba(0, 0, 0, 0.15);
            --border-color: #b3e0f2;
            --button-bg: #1cb5e0;
            --button-hover: #0d99c6;
            --input-border: #90cdf4;
            --footer-bg: #e6f0fa;
            --error-color: #f56565;
            --success-color: #38b2ac;
            --warning-color: #ed8936;
        }

        [data-theme="forest"] {
            --bg-gradient: linear-gradient(to right, #2a3d2a, #4a7043, #8bb174, #a8d5a2);
            --primary-color: #2e7d32;
            --secondary-color: #a5d6a7;
            --card-bg: #e8f5e9;
            --card-shadow: 0 4px 24px rgba(0, 0, 0, 0.15);
            --border-color: #c8e6c9;
            --button-bg: #2e7d32;
            --button-hover: #1b5e20;
            --input-border: #a5d6a7;
            --footer-bg: #e8f5e9;
            --error-color: #e57373;
            --success-color: #4caf50;
            --warning-color: #ffb300;
        }

        body {
            background: var(--bg-gradient);
            font-family: 'Inter', sans-serif;
            color: var(--secondary-color);
            line-height: 1.6;
            overflow-x: hidden;
            transition: background 0.3s ease;
        }

        .sidebar {
            position: fixed;
            top: 0;
            left: 0;
            transform: translateX(-100%);
            width: var(--sidebar-width);
            height: 100%;
            background: var(--card-bg);
            padding: 2rem 1.5rem;
            box-shadow: var(--card-shadow);
            border-right: 1px solid var(--border-color);
            transition: transform 0.3s ease-in-out;
            z-index: 1000;
            display: flex; /* Use flexbox for vertical alignment */
            flex-direction: column; /* Stack items vertically */
        }

        .sidebar.open {
            transform: translateX(0);
        }

        .sidebar-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--border-color);
        }

        .sidebar h1 {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--primary-color);
        }

        .theme-toggle-btn {
            padding: 0.5rem;
            background: transparent;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            color: var(--primary-color);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .theme-toggle-btn:hover {
            background: var(--button-bg);
            color: #ffffff;
        }

        .nav-btn {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            width: 100%;
            padding: 0.75rem 1rem;
            margin-bottom: 0.5rem;
            background: transparent;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            color: var(--secondary-color);
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .nav-btn:hover {
            background: var(--button-bg);
            color: #ffffff;
            border-color: var(--button-bg);
        }

        .nav-btn.active {
            background: var(--button-bg);
            color: #ffffff;
            border-color: var(--button-bg);
        }

        .toggle-btn {
            position: fixed;
            top: 1.5rem;
            left: 1.5rem;
            width: 44px;
            height: 44px;
            background: var(--button-bg);
            color: #ffffff;
            border: none;
            border-radius: var(--border-radius);
            font-size: 1.2rem;
            cursor: pointer;
            z-index: 1001;
            transition: transform 0.3s ease-in-out;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .toggle-btn.open {
            transform: translateX(calc(var(--sidebar-width)));
        }

        /* Updated Hero Section with Slideshow */
        .hero-section {
            background: linear-gradient(135deg, var(--primary-color), #3b82f6);
            padding: 4rem 2rem;
            border-radius: var(--border-radius);
            color: #ffffff;
            text-align: center;
            margin: 2rem 0;
            position: relative;
            overflow: hidden;
            animation: fadeIn 1s ease-out;
        }

        .hero-title {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 1rem;
            position: relative;
            z-index: 2;
        }

        .hero-subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
            max-width: 700px;
            margin: 0 auto;
            position: relative;
            z-index: 2;
        }

        /* Slideshow Styles */
        .slideshow-container {
            position: relative;
            width: 150%;
            max-width: 1200px;
            height: 300px; /* Default height */
            overflow: hidden;
            border-radius: var(--border-radius);
            box-shadow: var(--card-shadow);
        }


        .slide {
            position: absolute;
            width: 100%;
            height: 100%;
            opacity: 0;
            transition: opacity 1s ease-in-out;
        }

        .slide.active {
            opacity: 1;
        }

        .slide img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .slideshow-nav {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 10px;
            z-index: 2;
        }

        .slideshow-nav button {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            border: 2px solid #ffffff;
            background: transparent;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        .slideshow-nav button.active {
            background: #ffffff;
        }

        .container {
            max-width: 1280px;
            margin: 0 auto;
            padding: 0 1.5rem;
            transition: margin-left 0.3s ease-in-out;
        }

        .container.shifted {
            margin-left: calc(var(--sidebar-width) + 20px);
        }

        .section {
            background: var(--card-bg);
            padding: 2rem;
            border-radius: var(--border-radius);
            margin: 2rem 0;
            box-shadow: var(--card-shadow);
            display: none;
        }

        .button-group {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .feature-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 1.5rem;
            margin: 2rem 0;
        }

        .feature-card {
            background: var(--card-bg);
            padding: 1.5rem;
            border-radius: var(--border-radius);
            text-align: center;
            box-shadow: var(--card-shadow);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            cursor: pointer;
        }

        .feature-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.12);
        }

        .feature-card span {
            font-size: 2.5rem;
            margin-bottom: 0.75rem;
            display: block;
        }

        .feature-card h3 {
            font-size: 1.25rem;
            color: var(--primary-color);
            margin-bottom: 0.5rem;
            font-weight: 600;
        }

        .input-group {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
            background: var(--card-bg);
            padding: 0.75rem;
            border-radius: var(--border-radius);
            box-shadow: var(--card-shadow);
        }

        input[type="text"] {
            flex: 1;
            padding: 0.75rem 1rem;
            border: 1px solid var(--input-border);
            border-radius: 8px;
            font-size: 1rem;
            background: var(--card-bg);
            color: var(--secondary-color);
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }

        input[type="text"]:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        button.primary {
            padding: 0.75rem 1.5rem;
            background: var(--button-bg);
            color: #ffffff;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 500;
            transition: background 0.3s ease, transform 0.2s ease;
        }

        button.primary:hover:not(:disabled) {
            background: var(--button-hover);
            transform: translateY(-2px);
        }

        button.primary:disabled {
            background: #9ca3af;
            cursor: not-allowed;
            transform: none;
        }

        .video-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-top: 1.5rem;
        }

        .video-card {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: var(--card-shadow);
            transition: transform 0.3s ease;
        }

        .video-card:hover {
            transform: translateY(-4px);
        }

        .video-title {
            padding: 1rem;
            font-weight: 500;
            color: var(--primary-color);
            text-align: center;
            font-size: 0.9rem;
        }

        .error-message {
            background: rgba(220, 38, 38, 0.1);
            color: var(--error-color);
            padding: 1rem;
            border-radius: var(--border-radius);
            margin: 1rem 0;
            border-left: 4px solid var(--error-color);
        }

        .loading {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            color: var(--primary-color);
            font-weight: 500;
            margin: 1.5rem 0;
            padding: 1rem;
            background: rgba(37, 99, 235, 0.1);
            border-radius: var(--border-radius);
        }

        .loading::before {
            content: '';
            width: 20px;
            height: 20px;
            border: 2px solid var(--primary-color);
            border-top-color: transparent;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        .nutrition-card, .exercise-card, .sleep-card, .stress-card, .wellness-card {
            background: var(--card-bg);
            padding: 1.5rem;
            border-radius: var(--border-radius);
            margin: 1rem 0;
            max-width: 800px;
            box-shadow: var(--card-shadow);
            display: none;
        }

        .nutrition-card {
            border-left: 6px solid #10b981;
        }

        .exercise-card {
            border-left: 6px solid #3b82f6;
        }

        .sleep-card {
            border-left: 6px solid #8b5cf6;
        }

        .stress-card {
            border-left: 6px solid #ef4444;
        }

        .wellness-card {
            border-left: 6px solid #f59e0b;
        }

        .health-tip-title {
            color: var(--warning-color);
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 1rem;
        }

        .nutrition-card .health-tip-title { color: #10b981; }
        .exercise-card .health-tip-title { color: #3b82f6; }
        .sleep-card .health-tip-title { color: #8b5cf6; }
        .stress-card .health-tip-title { color: #ef4444; }
        .wellness-card .health-tip-title { color: #f59e0b; }

        .health-tips-container ul {
            padding-left: 1.5rem;
            color: var(--secondary-color);
        }

        .health-tips-container li {
            margin-bottom: 0.5rem;
        }

        .response-content {
            background: var(--card-bg);
            padding: 1.5rem;
            border-radius: var(--border-radius);
            box-shadow: var(--card-shadow);
            margin: 1rem 0;
        }

        .response-content h2 {
            font-size: 1.5rem;
            color: var(--primary-color);
            margin-bottom: 1rem;
            font-weight: 600;
        }

        .response-content h3 {
            font-size: 1.25rem;
            color: var(--primary-color);
            margin: 1rem 0 0.5rem;
            font-weight: 500;
        }

        .response-content p {
            margin-bottom: 1rem;
            color: var(--secondary-color);
        }

        .response-content ul {
            list-style: none;
            padding-left: 1rem;
            margin-bottom: 1rem;
        }

        .response-content ul li {
            position: relative;
            padding-left: 1.5rem;
            margin-bottom: 0.5rem;
            color: var(--secondary-color);
        }

        .response-content ul li::before {
            content: '•';
            position: absolute;
            left: 0;
            color: var(--primary-color);
            font-size: 1.2rem;
        }

        .response-content .disclaimer {
            background: rgba(220, 38, 38, 0.1);
            padding: 1rem;
            border-radius: 8px;
            border-left: 4px solid var(--error-color);
            margin-bottom: 1rem;
            font-style: italic;
        }

        .app-footer {
            text-align: center;
            padding: 2rem;
            background: var(--footer-bg);
            margin-top: 2rem;
            box-shadow: var(--card-shadow);
            transition: margin-left 0.3s ease-in-out;
        }

        .app-footer.shifted {
            margin-left: calc(var(--sidebar-width) + 20px);
        }

        .footer-text p {
            color: var(--error-color);
            font-weight: 500;
            margin: 0.5rem 0;
            font-size: 0.9rem;
        }

        .footer-copyright p {
            color: var(--secondary-color);
            font-size: 0.85rem;
            margin: 0.5rem 0;
        }

        /* New styles for sidebar image */
        .sidebar-image-container {
            margin-top: 2rem;
            padding: 1rem;
            background: var(--card-bg);
            border-radius: var(--border-radius);
            box-shadow: var(--card-shadow);
            flex-shrink: 0; /* Prevent it from shrinking */
        }

        .sidebar-image {
            max-width: 100%;
            height: auto; /* Maintain aspect ratio */
            border-radius: 8px;
            display: block; /* Remove extra space below image */
            margin: 0 auto; /* Center the image */
        }

        /* Styles for News Section */
        .news-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-top: 1.5rem;
        }

        .news-card {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: var(--card-shadow);
            transition: transform 0.3s ease;
            text-decoration: none; /* For link styling */
            color: inherit; /* Inherit text color */
            display: flex;
            flex-direction: column;
        }

        .news-card:hover {
            transform: translateY(-4px);
        }

        .news-card img {
            width: 100%;
            height: 180px; /* Fixed height for consistency */
            object-fit: cover;
            border-bottom: 1px solid var(--border-color);
        }

        .news-content {
            padding: 1rem;
            flex-grow: 1; /* Allow content to take available space */
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .news-content h3 {
            font-size: 1.1rem;
            color: var(--primary-color);
            margin-bottom: 0.5rem;
            font-weight: 600;
        }

        .news-content p {
            font-size: 0.9rem;
            color: var(--secondary-color);
            margin-bottom: 0.75rem;
            flex-grow: 1;
        }

        .news-content .news-source-date {
            font-size: 0.8rem;
            color: #9ca3af;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }


        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Enhanced Responsive Design for Device Ratios */
        @media (max-width: 1200px) {
            :root { --sidebar-width: 260px; }
            .container { max-width: 100%; }
            .slideshow-container { height: 350px; }
        }

        @media (max-width: 992px) {
            :root { --sidebar-width: 240px; }
            .hero-title { font-size: 2.2rem; }
            .hero-subtitle { font-size: 1rem; }
            .slideshow-container { height: 300px; }
            .feature-section { grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); }
        }

        @media (max-width: 768px) {
            :root { --sidebar-width: 240px; }
            .container.shifted, .app-footer.shifted {
                margin-left: calc(var(--sidebar-width) + 20px);
            }
            .hero-title { font-size: 2rem; }
            .hero-subtitle { font-size: 1rem; }
            .input-group { flex-direction: column; }
            .button-group { flex-direction: column; }
            button.primary { width: 100%; }
            .slideshow-container { height: 250px; }
            .feature-section { grid-template-columns: 1fr; }
        }

        @media (max-width: 576px) {
            :root { --sidebar-width: 80vw; }
            .container.shifted, .app-footer.shifted {
                margin-left: calc(var(--sidebar-width) + 10px);
            }
            .hero-title { font-size: 1.75rem; }
            .hero-subtitle { font-size: 0.9rem; }
            .slideshow-container { height: 200px; }
            .sidebar { padding: 1.5rem 1rem; }
            .sidebar h1 { font-size: 1.25rem; }
            .nav-btn { font-size: 0.9rem; padding: 0.5rem; }
        }

        /* Specific Ratios (e.g., 18:9, 19.5:9) */
        @media (max-aspect-ratio: 18/9) {
            .slideshow-container { height: 45vw; }
            .hero-section { padding: 3rem 1.5rem; }
        }

        @media (max-aspect-ratio: 16/9) {
            .slideshow-container { height: 50vw; }
            .feature-card { padding: 1rem; }
        }

        @media (min-aspect-ratio: 19.5/9) {
            .slideshow-container { height: 40vw; }
            .container { padding: 0 1rem; }
        }
    </style>
</head>


    <nav class="sidebar open" id="sidebar" aria-label="Main navigation">
        <div class="sidebar-header">
            <h1>MediBot</h1>
            <button class="theme-toggle-btn" onclick="toggleTheme()" aria-label="Toggle theme">☀️</button>
        </div>
        <button class="nav-btn active" onclick="showSection('home')" aria-label="Home"><span>🏠</span> Home</button>
        <button class="nav-btn" onclick="showSection('emergency')" aria-label="Emergency Response"><span>🚨</span> Emergency Response</button>
        <button class="nav-btn" onclick="showSection('medicine')" aria-label="Medicine Analysis"><span>💊</span> Medicine Analysis</button>
        <button class="nav-btn" onclick="showSection('remedies')" aria-label="Natural Remedies"><span>🌿</span> Natural Remedies</button>
        <button class="nav-btn" onclick="showSection('health_tips')" aria-label="Health Tips"><span>🩺</span> Health Tips</button>
        <button class="nav-btn" onclick="showSection('balanced_diet')" aria-label="Balanced Diet"><span>🍽️</span> Balanced Diet</button>
        <button class="nav-btn" onclick="showSection('news')" aria-label="Healthcare News"><span>📰</span> News</button>
    </nav>

    <button class="toggle-btn open" id="toggle-btn" onclick="toggleSidebar()" aria-label="Toggle sidebar navigation"><</button>

    <main class="container shifted" id="main-container">
        <section id="home" aria-labelledby="home-title">
            <div class="hero-section">
                <h1 class="hero-title" id="home-title">MediBot-Assistant</h1>
                <p class="hero-subtitle">Your professional medical companion for emergency guidance, medication analysis, natural remedies, and wellness advice.</p>
                <!-- Slideshow Container --></div>
                <div class="slideshow-container">
                    <div class="slide"><img src="https://placehold.co/200x150/86a8e7/ffffff?text=AI+Health" alt="Health Image 1" width="20"></div>
                    <div class="slide"><img src="https://placehold.co/200x150/feb47b/ffffff?text=Medical+Tech" alt="Health Image 2"></div>
                    <div class="slide"><img src="https://placehold.co/200x150/ff7e5f/ffffff?text=Healthcare+Innovation" alt="Health Image 3"></div>
                    <div class="slideshow-nav">
                        <button class="nav-dot active" onclick="setSlide(0)"></button>
                        <button class="nav-dot" onclick="setSlide(1)"></button>
                        <button class="nav-dot" onclick="setSlide(2)"></button>
                    </div>
                </div>
            

            <div class="feature-section" role="region" aria-label="Feature cards">
                <div class="feature-card" onclick="showSection('emergency')" tabindex="0" role="button" aria-label="Emergency Response feature">
                    <span aria-hidden="true">🚨</span>
                    <h3>Emergency Response</h3>
                    <p>Immediate AI-powered guidance for medical emergencies.</p>
                </div>
                <div class="feature-card" onclick="showSection('medicine')" tabindex="0" role="button" aria-label="Medicine Analysis feature">
                    <span aria-hidden="true">💊</span>
                    <h3>Medicine Analysis</h3>
                    <p>Detailed information on medications and their usage.</p>
                </div>
                <div class="feature-card" onclick="showSection('remedies')" tabindex="0" role="button" aria-label="Natural Remedies feature">
                    <span aria-hidden="true">🌿</span>
                    <h3>Natural Remedies</h3>
                    <p>Holistic solutions for common health concerns.</p>
                </div>
                <div class="feature-card" onclick="showSection('health_tips')" tabindex="0" role="button" aria-label="Health Tips feature">
                    <span aria-hidden="true">🩺</span>
                    <h3>Health Tips</h3>
                    <p>Expert advice on nutrition and wellness.</p>
                </div>
                <div class="feature-card" onclick="showSection('balanced_diet')" tabindex="0" role="button" aria-label="Balanced Diet feature">
                    <span aria-hidden="true">🍽️</span>
                    <h3>Balanced Diet</h3>
                    <p>Personalized nutrition plans and tips.</p>
                </div>
            </div>
        </section>

        <section id="emergency" class="section" aria-labelledby="emergency-title">
            <h2 id="emergency-title">🚨Emergency Response</h2>
            <p>Describe the emergency for immediate guidance and resources.</p>
            <form class="input-group" onsubmit="fetchEmergencyContent(); return false;">
                <input type="text" id="emergency-input" placeholder="e.g., cardiac arrest, severe burn" aria-label="Emergency situation input" required>
                <button class="primary" type="submit" aria-label="Search emergency guidance">Search</button>
            </form>
            <div id="emergency-text" aria-live="polite"></div>
            <div id="emergency-videos" class="video-grid" aria-label="Emergency reference videos"></div>
        </section>

        <section id="medicine" class="section" aria-labelledby="medicine-title">
            <h2 id="medicine-title">💊Medicine Analysis</h2>
            <p>Enter a medication name for detailed information.</p>
            <form class="input-group" onsubmit="fetchMedicineContent(); return false;">
                <input type="text" id="medicine-input" placeholder="e.g., Paracetamol, Amoxicillin" aria-label="Medication name input" required>
                <button class="primary" type="submit" aria-label="Search medication information">Search</button>
            </form>
            <div id="medicine-text" aria-live="polite"></div>
            <div id="medicine-videos" class="video-grid" aria-label="Medicine reference videos"></div>
        </section>

        <section id="remedies" class="section" aria-labelledby="remedies-title">
            <h2 id="remedies-title">🌿Natural Remedies</h2>
            <p>Describe symptoms for natural remedy suggestions.</p>
            <form class="input-group" onsubmit="fetchRemedyContent(); return false;">
                <input type="text" id="remedies-input" placeholder="e.g., headache, sore throat" aria-label="Symptoms input" required>
                <button class="primary" type="submit" aria-label="Search natural remedies">Search</button>
            </form>
            <div id="remedies-text" aria-live="polite"></div>
            <div id="remedies-videos" class="video-grid" aria-label="Remedies reference videos"></div>
        </section>

        <section id="health_tips" class="section" aria-labelledby="health-tips-title">
            <h2 id="health-tips-title">🌱 Health Tips</h2>
            <p>Generate personalized health and wellness tips.</p><br>
            <div class="button-group">
                <button class="primary" id="generate-tips-btn" onclick="generateHealthTips()" aria-label="Generate health tips">Generate Tips</button>
                <button class="primary" id="download-tips-btn" onclick="downloadHealthTips()" aria-label="Download health tips as PDF" disabled>Download Tips</button>
            </div>
            <div id="health-tips-text" class="health-tips-container" aria-live="polite">
                <div id="nutritionTips" class="nutrition-card" style="display: none;">
                    <h3 class="health-tip-title">🍎 Nutrition Tips</h3>
                </div>
                <div id="exerciseTips" class="exercise-card" style="display: none;">
                    <h3 class="health-tip-title">🏋️‍♂️ Exercise Tips</h3>
                </div>
                <div id="sleepTips" class="sleep-card" style="display: none;">
                    <h3 class="health-tip-title">🛌 Sleep Tips</h3>
                </div>
                <div id="stressTips" class="stress-card" style="display: none;">
                    <h3 class="health-tip-title">🧘 Stress Management Tips</h3>
                </div>
                <div id="wellnessNotes" class="wellness-card" style="display: none;">
                    <h3 class="health-tip-title">🌟 General Wellness Notes</h3>
                </div>
            </div>
        </section>

        <section id="balanced_diet" class="section" aria-labelledby="balanced-diet-title">
            <h2 id="balanced-diet-title">🍽️ Balanced Diet</h2>
            <p>Enter a diet query for nutrition advice.</p>
            <form class="input-group" onsubmit="fetchBalancedDietContent(); return false;">
                <input type="text" id="balanced-diet-input" placeholder="e.g., healthy meal plan, vegan nutrition" aria-label="Diet query input" required>
                <button class="primary" type="submit" aria-label="Search diet information">Search</button>
            </form>
            <div id="balanced-diet-text" aria-live="polite"></div>
            <div id="balanced-diet-videos" class="video-grid" aria-label="Diet reference videos"></div>
        </section>

        <!-- New Section for Health News -->
        <section id="news" class="section" aria-labelledby="news-title">
            <h2 id="news-title">📰 Latest Healthcare News</h2>
            <p>Stay updated with the most recent news in healthcare.</p>
            <div id="news-articles-container" class="news-grid" aria-live="polite">
                <!-- News articles will be loaded here -->
            </div>
        </section>
    </main>

    <footer class="app-footer shifted" id="footer" aria-label="Footer">
        <div class="footer-text">
            <p>⚠️ MediBot provides medical information for guidance only. Always consult healthcare professionals for treatment.</p>
        </div>
        <div class="footer-copyright">
            <p>© 2025 MediBot Assistant | All Rights Reserved</p>
        </div>
    </footer>

    <script>
        // Configuration
const config = {
            GEMINI_API_URL: 'https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent',
            YOUTUBE_API_URL: 'https://www.googleapis.com/youtube/v3/search',
            MAX_VIDEO_RESULTS: 3,
            GEMINI_API_KEY: "AIzaSyAZ2u9bW-QXxKMFLQSI727jdJqbWQuRARY",
            YOUTUBE_API_KEY: "AIzaSyByIqX-_-Neau9XR90el7Im3UjCHXkZ6M4",
            MAPS_API_KEY: "AIzaSyDkUVIEwHZF6Me8fX5YBGrDNo7nIDsZWFA0",
            // This is your new, correct GNews API Key!
            NEWS_API_KEY: "c5d28615f046448f86af15e2b8a2f95e",
            // This URL will now correctly use your new GNews API Key
            NEWS_API_URL: `https://gnews.io/api/v4/search?q=healthcare&lang=en&max=9&token=${this.NEWS_API_KEY}`,
            // New: List of images for the sidebar
        };
        // State
        let currentTheme = localStorage.getItem('theme') || 'light';
        let healthTipsGenerated = false;
        let isGenerating = false;
        let currentSlide = 0;
        let slideInterval;

        // Initialize tip history from localStorage or create empty
        let tipHistory = JSON.parse(localStorage.getItem('tipHistory')) || {
            nutrition: [],
            exercise: [],
            sleep: [],
            stress: [],
            wellness: []
        };

        // Limit history to 50 tips per category to prevent storage issues
        const MAX_HISTORY = 10000;

        // Fallback tips in case API fails to provide enough unique tips
        const fallbackTips = {
            nutrition: [
                "Eat a variety of colorful vegetables daily.",
                "Choose whole grains over refined grains.",
                "Limit added sugars in your diet."
            ],
            exercise: [
                "Aim for 30 minutes of daily activity.",
                "Incorporate strength training twice weekly.",
                "Try a new sport or workout."
            ],
            sleep: [
                "Maintain a consistent sleep schedule.",
                "Avoid screens before bedtime.",
                "Create a relaxing bedroom environment."
            ],
            stress: [
                "Practice deep breathing exercises daily.",
                "Take short breaks during work.",
                "Engage in a favorite hobby."
            ],
            wellness: [
                "Stay hydrated throughout the day.",
                "Schedule regular health check-ups.",
                "Practice gratitude to boost mood."
            ]
        };

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            const validThemes = ['light', 'dark', 'high-contrast', 'ocean', 'forest'];
            if (!validThemes.includes(currentTheme)) {
                currentTheme = 'light';
                localStorage.setItem('theme', 'light');
            }

            if (currentTheme === 'dark') {
                document.body.setAttribute('data-theme', 'dark');
            } else if (currentTheme === 'high-contrast') {
                document.body.setAttribute('data-theme', 'high-contrast');
            } else if (currentTheme === 'ocean') {
                document.body.setAttribute('data-theme', 'ocean');
            } else if (currentTheme === 'forest') {
                document.body.setAttribute('data-theme', 'forest');
            } else {
                document.body.removeAttribute('data-theme');
            }

            const themeBtn = document.querySelector('.theme-toggle-btn');
            themeBtn.textContent = currentTheme === 'light' ? '☀️' : 
                                  currentTheme === 'dark' ? '🌙' : 

            showSection('home');
            initSlideshow();
            updateSidebarImage(); // Call to display initial sidebar image
            setInterval(updateSidebarImage, 10000); // Change image every 10 seconds
        });

        // Slideshow Functions
        function initSlideshow() {
            const slides = document.querySelectorAll('.slide');
            const dots = document.querySelectorAll('.slideshow-nav button');
            if (slides.length === 0) return;

            slides[0].classList.add('active');
            dots[0].classList.add('active');

            slideInterval = setInterval(nextSlide, 5000); // Change slide every 5 seconds
        }

        function nextSlide() {
            const slides = document.querySelectorAll('.slide');
            const dots = document.querySelectorAll('.slideshow-nav button');
            slides[currentSlide].classList.remove('active');
            dots[currentSlide].classList.remove('active');
            currentSlide = (currentSlide + 1) % slides.length;
            slides[currentSlide].classList.add('active');
            dots[currentSlide].classList.add('active');
        }

        function setSlide(index) {
            const slides = document.querySelectorAll('.slide');
            const dots = document.querySelectorAll('.slideshow-nav button');
            slides[currentSlide].classList.remove('active');
            dots[currentSlide].classList.remove('active');
            currentSlide = index;
            slides[currentSlide].classList.add('active');
            dots[currentSlide].classList.add('active');
            clearInterval(slideInterval);
            slideInterval = setInterval(nextSlide, 5000);
        }

        function toggleTheme() {
            const themeBtn = document.querySelector('.theme-toggle-btn');
            if (currentTheme === 'light') {
                document.body.setAttribute('data-theme', 'dark');
                themeBtn.textContent = '🌙';
                currentTheme = 'dark';

            } else {
                document.body.removeAttribute('data-theme');
                themeBtn.textContent = '☀️';
                currentTheme = 'light';
            }
            localStorage.setItem('theme', currentTheme);
        }

        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const toggleBtn = document.getElementById('toggle-btn');
            const container = document.getElementById('main-container');
            const footer = document.getElementById('footer');

            sidebar.classList.toggle('open');
            toggleBtn.classList.toggle('open');
            toggleBtn.textContent = sidebar.classList.contains('open') ? '<' : '>';
            container.classList.toggle('shifted', sidebar.classList.contains('open'));
            footer.classList.toggle('shifted', sidebar.classList.contains('open'));
        }

        function showSection(sectionId) {
            document.querySelectorAll('#home, .section').forEach(section => {
                section.style.display = section.id === sectionId ? 'block' : 'none';
            });

            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.toggle('active', btn.getAttribute('onclick') === `showSection('${sectionId}')`);
                // Ensure to load news when the news section is shown
                if (sectionId === 'news') {
                    fetchNewsContent();
                }
                if (sectionId !== 'health_tips') healthTipsGenerated = false;
            });

            const input = document.getElementById(`${sectionId}-input`);
            if (input) input.focus();

            if (sectionId === 'health_tips' && !healthTipsGenerated) {
                console.log('Showing health_tips section, triggering auto-generation');
                waitForElement('health-tips-text', () => {
                    console.log('health-tips-text found, calling generateHealthTips');
                    generateHealthTips();
                    healthTipsGenerated = true;
                });
            }
        }

        function waitForElement(id, callback, maxAttempts = 10, interval = 100) {
            let attempts = 0;
            const checkElement = () => {
                const element = document.getElementById(id);
                const isVisible = element && window.getComputedStyle(document.getElementById('health_tips')).display === 'block';
                console.log(`Checking for ${id}: ${element ? 'Found' : 'Not found'}, Visible: ${isVisible}`);
                if (element && isVisible) {
                    callback();
                } else if (attempts < maxAttempts) {
                    attempts++;
                    setTimeout(checkElement, interval);
                } else {
                    console.error(`Element ${id} not found after ${maxAttempts} attempts`);
                    showError('Health tips section not available. Please try again.');
                }
            };
            checkElement();
        }

        function sanitizeInput(input) {
            const div = document.createElement('div');
            div.textContent = input;
            return div.innerHTML;
        }

        function processGeminiResponse(text) {
            let cleanedText = text
                .replace(/##+\s*/g, '')
                .replace(/\*\*/g, '')
                .replace(/\*/g, '')
                .replace(/-\s/g, '')
                .replace(/^\s*>\s*/gm, '')
                .replace(/`[^`]*`/g, match => match.slice(1, -1));

            const sections = cleanedText.split('\n\n').filter(section => section.trim());

            let html = '<div class="response-content">';
            
            sections.forEach((section, index) => {
                section = section.trim();
                
                if (section.toLowerCase().includes('disclaimer') || section.toLowerCase().includes('warning')) {
                    html += `<div class="disclaimer">${section}</div>`;
                    return;
                }

                if (index === 0 && section.length < 100) {
                    html += `<h2>${section}</h2>`;
                } else if (section.length < 5000 && section.match(/^[A-Z][\w\s:]+$/)) {
                    html += `<h3>${section}</h3>`;
                } else if (section.includes(':')) {
                    const lines = section.split('\n').filter(line => line.trim());
                    if (lines.every(line => line.includes(':'))) {
                        html += '<ul>';
                        lines.forEach(line => {
                            const [key, value] = line.split(':').map(s => s.trim());
                            html += `<li><strong>${key}:</strong> ${value}</li>`;
                        });
                        html += '</ul>';
                    } else {
                        html += `<p>${section}</p>`;
                    }
                } else {
                    const lines = section.split('\n').filter(line => line.trim());
                    if (lines.length > 1 && lines.every(line => line.match(/^[A-Za-z\s]/))) {
                        html += '<ul>';
                        lines.forEach(line => {
                            html += `<li>${line}</li>`;
                        });
                        html += '</ul>';
                    } else {
                        html += `<p>${section}</p>`;
                    }
                }
            });

            html += '</div>';
            return html;
        }

        async function fetchAPI(url, options, retries = 2, delay = 1000) {
            for (let attempt = 1; attempt <= retries; attempt++) {
                try {
                    const response = await fetch(url, options);
                    if (!response.ok) {
                        let errorMessage = 'API request failed';
                        try {
                            const errorData = await response.json();
                            errorMessage = errorData.error?.message || `HTTP ${response.status}: ${response.statusText}`;
                        } catch {
                            errorMessage = `HTTP ${response.status}: ${response.statusText}`;
                        }
                        throw new Error(errorMessage);
                    }
                    return response.json();
                } catch (error) {
                    console.error(`Attempt ${attempt} failed for ${url}:`, error.message);
                    if (attempt === retries) {
                        let userMessage = error.message.includes('API key') 
                            ? 'Invalid or restricted API key. Please check your API configuration.'
                            : error.message.includes('HTTP 429')
                            ? 'API rate limit exceeded. Please try again later.'
                            : `Failed to fetch data: ${error.message}`;
                        // Add specific guidance for 426 error
                        if (error.message.includes('HTTP 426')) {
                            userMessage += '. This often means your NewsAPI plan does not support this endpoint, or requests from this domain are blocked. Please check NewsAPI documentation for details on "Upgrade Required" or domain whitelisting.';
                        }
                        throw new Error(userMessage);
                    }
                    await new Promise(resolve => setTimeout(resolve, delay));
                }
            }
        }

        async function fetchGeminiText(query, textContainerId, promptPrefix) {
            const container = document.getElementById(textContainerId);
            if (!container) {
                console.error(`Container ${textContainerId} not found`);
                return;
            }
            container.innerHTML = '<div class="loading">Loading information...</div>';

            try {
                const sanitizedQuery = sanitizeInput(query);
                const data = await fetchAPI(`${config.GEMINI_API_URL}?key=${config.GEMINI_API_KEY}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: `${promptPrefix} ${sanitizedQuery}` }] }],
                    }),
                });

                const text = data.candidates[0].content.parts[0].text;
                container.innerHTML = processGeminiResponse(text);
            } catch (error) {
                console.error('Gemini API Error:', error);
                container.innerHTML = `<p class="error-message">Error loading information: ${error.message}</p>`;
            }
        }

        async function fetchVideos(query, containerId) {
            const container = document.getElementById(containerId);
            if (!container) {
                console.error(`Container ${containerId} not found`);
                return;
            }
            container.innerHTML = '<div class="loading">Loading reference videos...</div>';

            try {
                const sanitizedQuery = sanitizeInput(query);
                const data = await fetchAPI(
                    `${config.YOUTUBE_API_URL}?part=snippet&q=${encodeURIComponent(sanitizedQuery)}&type=video&videoEmbeddable=true&maxResults=${config.MAX_VIDEO_RESULTS}&key=${config.YOUTUBE_API_KEY}`
                );

                if (!data.items.length) {
                    container.innerHTML = '<p class="error-message">No reference videos found.</p>';
                    return;
                }

                const videos = data.items.map(item => ({
                    title: item.snippet.title,
                    videoId: item.id.videoId,
                }));
                displayVideos(videos, containerId);
            } catch (error) {
                console.error('YouTube API Error:', error);
                container.innerHTML = `<p class="error-message">Error loading videos: ${error.message}</p>`;
            }
        }

        function displayVideos(videos, containerId) {
            const container = document.getElementById(containerId);
            if (!container) {
                console.error(`Container ${containerId} not found`);
                return;
            }
            container.innerHTML = videos
                .map(
                    video => `
                        <div class="video-card">
                            <iframe
                                src="https://www.youtube.com/embed/${video.videoId}"
                                style="width: 100%; aspect-ratio: 16/9; border: none;"
                                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                                allowfullscreen
                                title="${video.title}"
                            ></iframe>
                            <div class="video-title">${video.title.slice(0, 60)}...</div>
                        </div>
                    `
                )
                .join('');
        }

        function saveTipHistory(newTips) {
            const allExistingTips = Object.values(tipHistory).flat();
            for (const category in newTips) {
                const uniqueTips = newTips[category].filter(
                    tip => !allExistingTips.includes(tip) && !tipHistory[category].includes(tip)
                );
                tipHistory[category] = [
                    ...tipHistory[category],
                    ...uniqueTips
                ].slice(-MAX_HISTORY);
            }
            localStorage.setItem('tipHistory', JSON.stringify(tipHistory));
        }

        function renderTips(containerId, tips) {
            console.log(`Rendering tips for ${containerId}, Tips:`, tips);
            let container = document.getElementById(containerId);
            if (!container) {
                console.warn(`Container ${containerId} not found, attempting to create`);
                const parent = document.getElementById('health-tips-text');
                if (!parent) {
                    console.error('Parent container health-tips-text not found');
                    showError('Health tips section not available. Please try again.');
                    return;
                }
                container = document.createElement('div');
                container.id = containerId;
                container.className = {
                    nutritionTips: 'nutrition-card',
                    exerciseTips: 'exercise-card',
                    sleepTips: 'sleep-card',
                    stressTips: 'stress-card',
                    wellnessNotes: 'wellness-card'
                }[containerId] || 'wellness-card';
                container.style.display = 'none';
                const title = document.createElement('h3');
                title.className = 'health-tip-title';
                title.textContent = {
                    nutritionTips: '🍎 Nutrition Tips',
                    exerciseTips: '🏋️‍♂️ Exercise Tips',
                    sleepTips: '🛌 Sleep Tips',
                    stressTips: '🧘 Stress Management Tips',
                    wellnessNotes: '🌟 General Wellness Notes'
                }[containerId] || '🌟 General Wellness Notes';
                container.appendChild(title);
                parent.appendChild(container);
            }
            container.style.display = tips.length > 0 ? 'block' : 'none';
            const ul = document.createElement('ul');
            tips.forEach(tip => {
                const li = document.createElement('li');
                li.textContent = tip;
                ul.appendChild(li);
            });
            while (container.children.length > 1) {
                container.removeChild(container.lastChild);
            }
            if (tips.length > 0) {
                container.appendChild(ul);
            }
        }

        function showError(message) {
            const errorDiv = document.createElement('div');
            errorDiv.className = 'error-message';
            errorDiv.textContent = message;
            const container = document.getElementById('health-tips-text'); // Fallback to a common container if possible
            if (container) {
                container.insertBefore(errorDiv, container.firstChild);
                setTimeout(() => errorDiv.remove(), 5000);
            } else {
                console.error('Cannot show error: health-tips-text container not found');
                // As a last resort, if no container is found, log to console.
                // Avoid using alert() in production web apps.
                console.error(message);
            }
        }

        async function generateHealthTips() {
            if (isGenerating) {
                console.log('generateHealthTips already in progress, skipping');
                return;
            }
            isGenerating = true;
            console.log('Starting generateHealthTips');
            const container = document.getElementById('health-tips-text');
            const generateBtn = document.getElementById('generate-tips-btn');
            const downloadBtn = document.getElementById('download-tips-btn');
            if (!container || !generateBtn || !downloadBtn) {
                console.error('Required elements not found: health-tips-text, generate-tips-btn, or download-tips-btn');
                showError('Cannot generate tips: Required elements missing');
                isGenerating = false;
                return;
            }
            const requiredIds = ['nutritionTips', 'exerciseTips', 'sleepTips', 'stressTips', 'wellnessNotes'];
            const missingIds = requiredIds.filter(id => !document.getElementById(id));
            if (missingIds.length > 0) {
                console.warn('Missing containers:', missingIds);
                missingIds.forEach(id => renderTips(id, []));
            }
            generateBtn.disabled = true;
            container.innerHTML = '<div class="loading">Generating health tips...</div>';

            try {
                const timestamp = new Date().toISOString();
                const allExistingTips = Object.values(tipHistory).flat();
                let prompt = `
                    Generate exactly 3 health tips for each of the following categories: nutrition, exercise, sleep, stress management, and general wellness.
                    Return the response in JSON format with the following structure:
                    {
                        "nutrition": ["tip1", "tip2", "tip2"],
                        "exercise": ["tip1", "tip2", "tip3"],
                        "sleep": ["tip1", "tip2", "tip3"],
                        "stress": ["tip1", "tip2", "tip3"],
                        "wellness": ["tip1", "tip2", "tip3"]
                    }
                    Ensure the tips are:
                    - Concise (max 30 words each)
                    - Practical and actionable
                    - Unique for this request (timestamp: ${timestamp})
                    - Distinct from each other within and across all categories
                    - Not included in the following previously used tips:
                    ${JSON.stringify(allExistingTips, null, 2)}
                `;

                let healthTips = { nutrition: [], exercise: [], sleep: [], stress: [], wellness: [] };
                const categories = Object.keys(healthTips);
                let apiAttempts = 0;
                const maxApiAttempts = 3;

                while (apiAttempts < maxApiAttempts) {
                    apiAttempts++;
                    console.log(`API attempt ${apiAttempts}`);
                    const data = await fetchAPI(`${config.GEMINI_API_URL}?key=${config.GEMINI_API_KEY}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            contents: [{ parts: [{ text: prompt }] }],
                            generationConfig: { temperature: 0.9 }
                        }),
                    });

                    let generatedText = data.candidates[0].content.parts[0].text;
                    console.log('API Response:', generatedText);
                    generatedText = generatedText.replace(/```json\n|\n```|```/g, '').trim();
                    let apiTips;
                    try {
                        apiTips = JSON.parse(generatedText);
                    } catch {
                        console.warn('Invalid JSON response, retrying...');
                        continue;
                    }

                    for (const category of categories) {
                        if (!apiTips[category] || !Array.isArray(apiTips[category])) {
                            console.warn(`Invalid tips for ${category}, retrying...`);
                            apiTips[category] = [];
                        }
                        const uniqueTips = apiTips[category].filter(
                            tip => !allExistingTips.includes(tip) && 
                                   !healthTips[category].includes(tip) &&
                                   !Object.values(healthTips).flat().includes(tip)
                        );
                        healthTips[category] = [...healthTips[category], ...uniqueTips].slice(0, 3);
                    }

                    const allComplete = categories.every(cat => healthTips[cat].length === 3);
                    if (allComplete) break;

                    const missingCategories = categories.filter(cat => healthTips[cat].length < 3);
                    if (missingCategories.length > 0) {
                        console.log(`Missing tips in ${missingCategories}, retrying...`);
                        prompt = `
                            Generate additional health tips for the following categories to reach exactly 3 unique tips per category:
                            ${missingCategories.map(cat => `${cat}: ${3 - healthTips[cat].length} tips needed`).join(', ')}.
                            Return in JSON format matching the previous structure.
                            Ensure tips are:
                            - Concise (max 40 words)
                            - Unique from:
                              - Existing tips: ${JSON.stringify(healthTips, null, 2)}
                              - Previous tips: ${JSON.stringify(allExistingTips, null, 2)}
                        `;
                    }
                }

                for (const category of categories) {
                    while (healthTips[category].length < 3) {
                        const availableFallbacks = fallbackTips[category].filter(
                            tip => !allExistingTips.includes(tip) && 
                                   !healthTips[category].includes(tip) &&
                                   !Object.values(healthTips).flat().includes(tip)
                        );
                        if (availableFallbacks.length === 0) {
                            console.warn(`No unique fallback tips available for ${category}`);
                            healthTips[category].push(`Generic ${category} tip ${healthTips[category].length + 1}`);
                        } else {
                            healthTips[category].push(availableFallbacks[0]);
                        }
                    }
                }

                const allNewTips = Object.values(healthTips).flat();
                const uniqueTips = new Set(allNewTips);
                if (uniqueTips.size !== allNewTips.length) {
                    console.warn('Duplicates detected in final tips, adjusting...');
                    for (const category of categories) {
                        healthTips[category] = [...new Set(healthTips[category])];
                        while (healthTips[category].length < 3) {
                            healthTips[category].push(`Unique ${category} tip ${healthTips[category].length + 1}`);
                        }
                    }
                }

                saveTipHistory(healthTips);

                container.innerHTML = '';
                renderTips('nutritionTips', healthTips.nutrition);
                renderTips('exerciseTips', healthTips.exercise);
                renderTips('sleepTips', healthTips.sleep);
                renderTips('stressTips', healthTips.stress);
                renderTips('wellnessNotes', healthTips.wellness);

                downloadBtn.disabled = false;
                healthTipsGenerated = true;
            } catch (error) {
                console.error('Health Tips Error:', error);
                container.innerHTML = '';
                showError(`Error generating health tips: ${error.message}`);
                downloadBtn.disabled = true;
            } finally {
                generateBtn.disabled = false;
                isGenerating = false;
            }
        }

        function downloadHealthTips() {
            const container = document.getElementById('health-tips-text');
            if (!container) {
                console.error('health-tips-text container not found for PDF download');
                // No alert here, error is logged.
                return;
            }
            const cards = container.querySelectorAll('.nutrition-card, .exercise-card, .sleep-card, .stress-card, .wellness-card');
            let textContent = '';

            cards.forEach(card => {
                if (card.style.display !== 'none') {
                    const title = card.querySelector('.health-tip-title')?.textContent || '';
                    const tipsList = card.querySelector('ul');
                    if (tipsList && tipsList.children.length > 0) {
                        const tips = Array.from(tipsList.children)
                            .map(li => `- ${li.textContent.trim()}`)
                            .join('\n');
                        textContent += `${title}\n${tips}\n\n`;
                    }
                }
            });

            if (!textContent.trim()) {
                showError('No health tips available to download. Please generate tips first.');
                return;
            }

            try {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF({
                    orientation: 'portrait',
                    unit: 'mm',
                    format: 'a4'
                });

                doc.setFont('helvetica', 'bold');
                doc.setFontSize(16);
                doc.text('MediBot Health Tips', 20, 20);

                doc.setFont('helvetica', 'normal');
                doc.setFontSize(12);
                const lines = doc.splitTextToSize(textContent, 170);
                let y = 30;
                lines.forEach(line => {
                    if (y > 270) {
                        doc.addPage();
                        y = 20;
                    }
                    doc.text(line, 20, y);
                    y += 6;
                });

                doc.setFontSize(10);
                doc.setFont('helvetica', 'italic');
                const footerText = [
                    '⚠️ MediBot provides medical information for guidance only. Always consult healthcare professionals for treatment.',
                    '© 2025 MediBot Assistant | All Rights Reserved'
                ];
                footerText.forEach((line, index) => {
                    doc.text(line, 20, doc.internal.pageSize.height - 20 + (index * 5));
                });

                console.log('PDF Content:', textContent);
                doc.save('health_tips.pdf');
            } catch (error) {
                console.error('PDF Generation Error:', error);
                showError('Failed to generate PDF. Please try again.');
            }
        }

        // New function to update the sidebar image
        function updateSidebarImage() {
            const imgElement = document.getElementById('sidebar-dynamic-image');
            if (imgElement && config.SIDEBAR_IMAGES && config.SIDEBAR_IMAGES.length > 0) {
                const randomIndex = Math.floor(Math.random() * config.SIDEBAR_IMAGES.length);
                imgElement.src = config.SIDEBAR_IMAGES[randomIndex];
                imgElement.alt = `AI/Health Image ${randomIndex + 1}`; // Update alt text dynamically
            }
        }

        async function fetchEmergencyContent() {
            const input = document.getElementById('emergency-input').value.trim();
            if (!input) {
                document.getElementById('emergency-text').innerHTML = '<p class="error-message">Please enter an emergency situation.</p>';
                document.getElementById('emergency-videos').innerHTML = '';
                return;
            }
            await Promise.all([
                fetchGeminiText(input, 'emergency-text', 'Provide detailed first aid guidance for the emergency situation:'),
                fetchVideos(`first aid ${input} emergency treatment tutorial medical`, 'emergency-videos'),
            ]);
        }

        async function fetchMedicineContent() {
            const input = document.getElementById('medicine-input').value.trim();
            if (!input) {
                document.getElementById('medicine-text').innerHTML = '<p class="error-message">Please enter a medication name.</p>';
                document.getElementById('medicine-videos').innerHTML = '';
                return;
            }
            await Promise.all([
                fetchGeminiText(input, 'medicine-text', 'Provide detailed information about the medication, including uses, side effects, and precautions:'),
                fetchVideos(`${input} medication information tutorial`, 'medicine-videos'),
            ]);
        }

        async function fetchRemedyContent() {
            const input = document.getElementById('remedies-input').value.trim();
            if (!input) {
                document.getElementById('remedies-text').innerHTML = '<p class="error-message">Please enter symptoms.</p>';
                document.getElementById('remedies-videos').innerHTML = '';
                return;
            }
            await Promise.all([
                fetchGeminiText(input, 'remedies-text', 'Suggest natural remedies for the symptoms:'),
                fetchVideos(`natural remedy for ${input} tutorial`, 'remedies-videos'),
            ]);
        }

        async function fetchBalancedDietContent() {
            const input = document.getElementById('balanced-diet-input').value.trim();
            if (!input) {
                document.getElementById('balanced-diet-text').innerHTML = '<p class="error-message">Please enter a diet-related query.</p>';
                document.getElementById('balanced-diet-videos').innerHTML = '';
                return;
            }
            await Promise.all([
                fetchGeminiText(input, 'balanced-diet-text', 'Provide detailed nutrition advice and diet plans for:'),
                fetchVideos(`balanced diet ${input} nutrition tutorial`, 'balanced-diet-videos'),
            ]);
        }

        async function fetchNewsContent() {
            const container = document.getElementById('news-articles-container');
            if (!container) {
                console.error('News articles container not found.');
                return;
            }
            container.innerHTML = '<div class="loading">Loading latest healthcare news...</div>';

            try {
                // Fetch top healthcare news using GNews API
                const gNewsUrl = `${config.NEWS_API_URL}?q=healthcare&lang=en&max=9&token=${config.NEWS_API_KEY}`;
                
                // IMPORTANT: If you are using a free GNews API key, it might require whitelisting the domain
                // from which the request is made. If you continue to see errors, please check your GNews API dashboard.
                // For local development, you might need a proxy or a paid plan.
                if (config.NEWS_API_KEY === "e214f4d79ec144a5b0106ab37f8d8519") {
                     container.innerHTML = '<p class="error-message">Please replace "e214f4d79ec144a5b0106ab37f8d8519" with your actual GNews API key in the config object to fetch news.</p>';
                     return;
                }

                const data = await fetchAPI(gNewsUrl);

                if (!data.articles || data.articles.length === 0) {
                    container.innerHTML = '<p class="error-message">No healthcare news found at this time.</p>';
                    return;
                }

                // GNews API structure has 'image' field directly for image URL
                const articlesToDisplay = data.articles.filter(article => 
                    article.image && 
                    (article.image.startsWith('http://') || article.image.startsWith('https://'))
                ).slice(0, 9); // Limit to 9 articles for a clean grid

                if (articlesToDisplay.length === 0) {
                    container.innerHTML = '<p class="error-message">No healthcare news with valid images found to display.</p>';
                    return;
                }

                displayNews(articlesToDisplay, container);

            } catch (error) {
                console.error('GNews API Error:', error);
                let errorMessage = `Error loading news: ${error.message}.`;
                if (error.message.includes('HTTP 403')) {
                    errorMessage += ' This often means your GNews API key is invalid, or the domain is not whitelisted. Please check your GNews API dashboard.';
                } else if (error.message.includes('HTTP 429')) {
                    errorMessage += ' You have exceeded the daily request limit for your GNews API key. Please try again tomorrow or upgrade your plan.';
                }
                container.innerHTML = `<p class="error-message">${errorMessage}</p>`;
            }
        }

        function displayNews(articles, container) {
            container.innerHTML = articles.map(article => `
                <a href="${article.url}" target="_blank" rel="noopener noreferrer" class="news-card">
                    <img src="${article.image}" alt="${article.title || 'News Image'}" onerror="this.onerror=null;this.src='[https://placehold.co/300x180/e0e0e0/000000?text=No+Image](https://placehold.co/300x180/e0e0e0/000000?text=No+Image)';">
                    <div class="news-content">
                        <h3>${article.title ? article.title.slice(0, 100) + (article.title.length > 100 ? '...' : '') : 'No Title'}</h3>
                        <p>${article.description ? article.description.slice(0, 150) + (article.description.length > 150 ? '...' : '') : 'No description available.'}</p>
                        <div class="news-source-date">
                            <span>${article.source.name || 'Unknown Source'}</span>
                            <span>${article.publishedAt ? new Date(article.publishedAt).toLocaleDateString() : 'N/A'}</span>
                        </div>
                    </div>
                </a>
            `).join('');
        }
    </script>
</body>
</html>
